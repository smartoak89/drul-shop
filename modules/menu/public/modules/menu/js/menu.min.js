var taracot_dlg_menu_edit=new UIkit.modal("#taracot_dlg_menu_edit"),edit_id,jstree_menu,edit_lng;$("#btn_item_edit").click(function(){var a=jstree_menu.jstree(!0).get_selected();if(a&&a.length&&!(a.length>1)&&"#"!=jstree_menu.jstree(!0).get_parent(a)){var b=jstree_menu.jstree(!0).get_node(a).text,c="";jstree_menu.jstree(!0).get_node(a).data&&jstree_menu.jstree(!0).get_node(a).data.url&&(c=jstree_menu.jstree(!0).get_node(a).data.url),edit_id=a,$("#taracot_dlg_menu_edit_text").val(b),$("#taracot_dlg_menu_edit_url").val(c),$("#taracot_dlg_menu_edit_page").val(""),taracot_dlg_menu_edit.show(),$(".taracot_dlg_menu_edit_field").each(function(){$(this).removeClass("uk-form-danger")}),$("#taracot_dlg_menu_edit_text").focus()}}),$("#btn_item_add").click(function(){var a=jstree_menu.jstree(!0).get_selected();!a||!a.length||a.length>1||jstree_menu.jstree(!0).get_path(a).length>2||(taracot_dlg_menu_edit.show(),$(".taracot_dlg_menu_edit_field").each(function(){$(this).val(""),$(this).removeClass("uk-form-danger")}),$("#taracot_dlg_menu_edit_text").focus(),edit_id=void 0)}),$("#btn_item_del").click(function(){var a=jstree_menu.jstree(!0),b=a.get_selected();if(b&&b.length){for(var c="",d=0;d<b.length;d++)c+=", "+a.get_node(b[d]).text;confirm(_lang_vars.confirm_menu_delete+"\n\n"+c.replace(/,/,""))&&a.delete_node(b[0])}}),$(".taracot_dlg_menu_edit_field").bind("keypress",function(a){submitOnEnter(a)&&$("#taracot_dlg_menu_edit_btn_save").click()}),$("#btn_item_delall").click(function(){confirm(_lang_vars.confirm_menu_deleteall)&&init_jstree([],!0)}),$("#btn_menu_save_cancel").click(function(){confirm(_lang_vars.confirm_menu_cancel)&&($("#menu_editor").addClass("uk-hidden"),$("#btn_load_menu").attr("disabled",!1))}),$("#btn_load_menu").click(function(){$("#load_menu_loading").removeClass("uk-hidden"),$("#btn_load_menu").attr("disabled",!0),edit_lng=$("#menu_lang").val(),$.ajax({type:"POST",url:"/cp/menu/data/load",dataType:"json",data:{lng:edit_lng},success:function(a){if($("#load_menu_loading").addClass("uk-hidden"),1==a.status)a.menu_source&&init_jstree(jQuery.parseJSON(a.menu_source)),jstree_menu.jstree(!0).get_container().find("li").length||jstree_insert_root(),$("#menu_editor").removeClass("uk-hidden"),$("#menu_edit_lang").html(edit_lng);else{$("#btn_load_menu").attr("disabled",!1);var b=_lang_vars.ajax_failed;a.error&&(b=a.error),UIkit.notify({message:b,status:"danger",timeout:2e3,pos:"top-center"})}},error:function(){$("#load_menu_loading").addClass("uk-hidden"),$("#btn_load_menu").attr("disabled",!1),UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"})}})}),$("#btn_menu_save").click(function(){for(var a=jstree_menu.jstree(!0).get_json(jstree_menu,{flat:!0,no_state:!0,no_id:!1,no_data:!1}),b=0;b<a.length;b++)delete a[b].li_attr,delete a[b].a_attr,delete a[b].icon,delete a[b].state;$.ajax({type:"POST",url:"/cp/menu/data/save",dataType:"json",data:{lng:edit_lng,menu_source:JSON.stringify(a)},success:function(a){if(taracot_ajax_progress_indicator("body",!1),1==a.status)$("#menu_editor").addClass("uk-hidden"),$("#btn_load_menu").attr("disabled",!1),UIkit.notify({message:_lang_vars.save_success,status:"success",timeout:2e3,pos:"top-center"});else{var b=_lang_vars.ajax_failed;a.error&&(b=a.error),UIkit.notify({message:b,status:"danger",timeout:2e3,pos:"top-center"})}},error:function(){taracot_ajax_progress_indicator("body",!1),UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"})}})}),$("#taracot_dlg_menu_edit_btn_save").click(function(){$(".taracot_dlg_menu_edit_field").each(function(){$(this).removeClass("uk-form-danger")});var a=jstree_menu.jstree(!0).get_selected();if(a&&a.length&&!(a.length>1)){var b=!1;if($("#taracot_dlg_menu_edit_text").val()||($("#taracot_dlg_menu_edit_text").addClass("uk-form-danger"),$("#taracot_dlg_menu_edit_text").select(),$("#taracot_dlg_menu_edit_text").focus(),b=!0),$("#taracot_dlg_menu_edit_url").val()||($("#taracot_dlg_menu_edit_url").addClass("uk-form-danger"),b||($("#taracot_dlg_menu_edit_text").select(),$("#taracot_dlg_menu_edit_text").focus()),b=!0),b)return void UIkit.notify({message:_lang_vars.form_contains_errors,status:"danger",timeout:2e3,pos:"top-center"});if(taracot_dlg_menu_edit.hide(),edit_id)jstree_menu.jstree(!0).rename_node(a,$("#taracot_dlg_menu_edit_text").val()),jstree_menu.jstree(!0).get_node(a).data||(jstree_menu.jstree(!0).get_node(a).data={}),jstree_menu.jstree(!0).get_node(a).data.url=$("#taracot_dlg_menu_edit_url").val();else{var c=jstree_menu.jstree(!0).create_node(a,{text:$("#taracot_dlg_menu_edit_text").val(),type:"folder"});jstree_menu.jstree(!0).get_node(c).data||(jstree_menu.jstree(!0).get_node(c).data={}),jstree_menu.jstree(!0).get_node(c).data.url=$("#taracot_dlg_menu_edit_url").val(),jstree_find_root(),jstree_menu.jstree(!0).open_all("#")}}}),$(document).ready(function(){$("#menu_lang").val(locales[0]),$("#btn_load_menu").attr("disabled",!1),$("#taracot_dlg_menu_edit_page").change(function(){$("#taracot_dlg_menu_edit_text").val($("#"+this.id+" option:selected").text().replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")),$("#taracot_dlg_menu_edit_url").val($(this).val())}),init_jstree()});var taracot_ajax_progress_indicator=function(a,b){if(b){var c=$(a).offset();$(".taracot-progress").css({top:c.top,left:c.left,width:$(a).width(),height:$(a).height()}),$(".taracot-progress").removeClass("uk-hidden")}else $(".taracot-progress").addClass("uk-hidden")},init_jstree=function(a,b){jstree_menu&&jstree_menu.jstree(!0).destroy(),jstree_menu=$("#jstree_menu").jstree({core:{check_callback:!0,data:a},plugins:["dnd","types"],types:{"#":{max_children:1,max_depth:3,valid_children:["root"]},root:{valid_children:["folder"]},folder:{valid_children:["folder"]}}}),jstree_menu.on("loaded.jstree",function(a,c){b&&jstree_insert_root(),jstree_menu.jstree(!0).open_all("#"),jstree_find_root()}),jstree_menu.on("changed.jstree",function(a,b){jstree_changed_handler(a,b)})},jstree_find_root=function(){for(var a=jstree_menu.jstree(!0).get_json(jstree_menu,{flat:!0,no_state:!0,no_id:!1,no_data:!1}),b=0;b<a.length;b++)"#"==a[b].parent&&jstree_menu.jstree(!0).select_node(a[b].id)},jstree_changed_handler=function(a,b){$(".taracot-treectl-button").attr("disabled",!1),(!b.selected.length||b.selected.length>1)&&$(".taracot-treectl-button").attr("disabled",!0),"#"==jstree_menu.jstree(!0).get_parent(b.selected[0])&&($("#btn_item_del").attr("disabled",!0),$("#btn_item_edit").attr("disabled",!0)),b.selected.length&&jstree_menu.jstree(!0).get_path(b.selected[0]).length>2&&$("#btn_item_add").attr("disabled",!0)},jstree_insert_root=function(){var a=jstree_menu.jstree(!0).create_node("#",{text:"/",type:"root"});jstree_menu.jstree(!0).select_node(a)};