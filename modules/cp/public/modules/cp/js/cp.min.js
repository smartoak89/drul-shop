var downcounter=20,downcounter_save=downcounter,taracot_dlg_update=new UIkit.modal("#taracot_dlg_update",{bgclose:!1,keyboard:!1}),taracot_dlg_reset=new UIkit.modal("#taracot_dlg_reset",{bgclose:!1,keyboard:!1}),taracot_btn_update_handler=function(){taracot_dlg_update.show()},taracot_restart_countdown=function(){downcounter--;var a=parseInt(100/downcounter_save)*downcounter,b=String(downcounter);1==b.length&&(b="0"+b),$(".taracot_updater_restart_progress").html("0:"+b),$(".taracot_updater_restart_progress").css("width",a+"%"),downcounter>0?setTimeout(taracot_restart_countdown,1e3):($(".taracot_updater_restart_progress").parent().hide(),location.href="/cp?rnd="+Math.random().toString().replace(".",""))},check_update_status=function(){$.ajax({type:"POST",url:"/cp/_update/status",dataType:"json",success:function(a){var b="";if(a.messages)for(var c=0;c<a.messages.length;c++)b+="<li>"+a.messages[c]+"</li>";$("#taracot_updater_messages").html(b),$(".taracot-update-progress-box").scrollTop(1e6),a.complete&&($(".taracot-update-progress-gif").hide(),a.failed?$("#taracot-update-progress").append('<p class="uk-alert uk-alert-danger">'+_lang_vars.update_failed+"</p>"):($("#taracot-update-progress").append('<p class="uk-alert uk-alert-success taracot-alert-update-success">'+_lang_vars.update_complete+'</p><div class="uk-progress"><div class="uk-progress-bar taracot_updater_restart_progress" style="width:100%;">0:'+downcounter+"</div></div>"),$.ajax({type:"POST",url:"/cp/_update/restart",dataType:"json",success:function(a){1===a.status?($(".taracot-alert-update-success").html(_lang_vars.restarting),setTimeout(taracot_restart_countdown,1e3)):($(".taracot_updater_restart_progress").parent().hide(),UIkit.notify({message:_lang_vars.restart_failed,status:"danger",timeout:2e3,pos:"top-center"}))},error:function(){$(".taracot_updater_restart_progress").parent().hide(),UIkit.notify({message:_lang_vars.restart_failed,status:"danger",timeout:2e3,pos:"top-center"})}}))),a.complete||a.failed||setTimeout(check_update_status,1e3)},error:function(){$(".taracot-update-progress-gif").hide(),$("#taracot_updater_messages").html("<li>"+_lang_vars.cannot_get_update_status+"</li>"),$("#taracot-update-progress").append('<p class="uk-alert uk-alert-danger">'+_lang_vars.update_failed+"</p>"),$(".taracot-update-progress-box").scrollTop(1e6)}})},taracot_btn_update_start_handler=function(){$(".taracot-dlg-update-footer").hide();var a=$("#taracot-update-progress").html();$("#taracot-update-progress").html('<p class="taracot-update-progress-gif"><img src="/modules/cp/images/loading_36x36.gif" class="uk-float-right"></p><i class="uk-icon-check"></i> '+_lang_vars.initializing_update+"<br>"),$.ajax({type:"POST",url:"/cp/_update/start",dataType:"json",success:function(b){if(b)if(1===b.status)$("#taracot-update-progress").append('<i class="uk-icon-check"></i> '+_lang_vars.update_started+"<p>"+_lang_vars.update_progress+':</p><div class="uk-scrollable-box taracot-update-progress-box"><div id="taracot_updater_messages" class="uk-list uk-list-line"></div></div>'),setTimeout(check_update_status,1e3);else{var c=b.error||_lang_vars.ajax_failed;UIkit.notify({message:c,status:"danger",timeout:2e3,pos:"top-center"}),$("#taracot-update-progress").html(a),$(".taracot-dlg-update-footer").show()}},error:function(){UIkit.notify({message:_lang_vars.ajax_failed,status:"danger",timeout:2e3,pos:"top-center"}),$("#taracot-update-progress").html(a),$(".taracot-dlg-update-footer").show()}})},taracot_btn_reset_handler=function(){var a=$("#taracot-restart-progress").html();$("#taracot-restart-progress").html('<div><p class="uk-alert taracot-alert-restart">'+_lang_vars.restarting+'</p><div class="uk-progress"><div class="uk-progress-bar taracot_updater_restart_progress" style="width:100%;">0:'+downcounter+"</div></div></div>"),$(".taracot-dlg-reset-footer").hide(),$.ajax({type:"POST",url:"/cp/_update/restart",dataType:"json",success:function(b){1===b.status?($(".taracot-alert-restart").html(_lang_vars.restarting),setTimeout(taracot_restart_countdown,1e3)):($(".taracot-dlg-reset-footer").show(),$("#taracot-restart-progress").html(a),UIkit.notify({message:_lang_vars.restart_failed,status:"danger",timeout:2e3,pos:"top-center"}))},error:function(){$(".taracot-dlg-reset-footer").show(),$("#taracot-restart-progress").html(a),UIkit.notify({message:_lang_vars.restart_failed,status:"danger",timeout:2e3,pos:"top-center"})}})},taracot_btn_reset_dialog_handler=function(){taracot_dlg_reset.show()},init_taracot_stats=function(){var a,b={labels:days,datasets:[{fillColor:"rgba(255,76,54,0.2)",strokeColor:"rgba(255,76,54,1)",pointColor:"rgba(255,76,54,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:visitors},{fillColor:"rgba(53,93,128,0.2)",strokeColor:"rgba(53,93,128,1)",pointColor:"rgba(53,93,128,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:hits}]},c={responsive:!0,animation:!0,bezierCurve:!1};if(visitors.length>1){a=new Chart($("#taracot_statistics").get(0).getContext("2d")).Line(b,c);for(var d=[],e=0;e<months.length;e++)d.push(months[e].month+" "+months[e].year);$("#h2_stat").append(" ("+d.join(", ")+")"),$("#taracot_statistics_wrap").append($("#taracot_statistics")),$("#taracot_statistics").show()}else $("#taracot_stats_wrap").html(_lang_vars.no_stats_avail)};$(document).ready(function(){0===total_updates_avail?($(".taracot-updates-exclamation").hide(),$(".taracot_updates_buttons_wrap").hide()):setInterval(function(){$(".taracot-updates-exclamation").toggle(),$(".taracot-updates-exclamation-grey").toggle()},500),$("#taracot_btn_update").click(taracot_btn_update_handler),$("#taracot_btn_update_start").click(taracot_btn_update_start_handler),$("#taracot_btn_reset").click(taracot_btn_reset_handler),$("#taracot_btn_reset_dialog").click(taracot_btn_reset_dialog_handler),init_taracot_stats()});